<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:mec="http://xmlns.jcp.org/jsf/composite/components" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:aghu="http://xmlns.jcp.org/jsf/component" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:mf="http://www.mec.gov.br/taglib">  
  <ui:composition template="/WEB-INF/templates/form_template.xhtml"> 
    <ui:define name="head"> 
      <title>#{messages.LABEL_AGENDAR_PROCEDIMENTOS}</title>  
      <style xml:space="preserve">
			#panelCirurgia {
				border: 0 !important;
				margin: 0 !important;
				padding: 0 !important;
			}
		</style> 
    </ui:define>  
    <ui:define name="metadata"> 
      <f:metadata> 
        <f:viewAction action="#{agendaProcedimentosController.inicio}"/> 
      </f:metadata> 
    </ui:define>  
    <ui:define name="body"> 
      <mec:pageConfig controller="#{agendaProcedimentosController}" ignoreEnter="true"/>  
      <h:form> 
        <pe:remoteCommand name="atualizarProfissionalPrincipal" immediate="true" actionListener="#{agendaProcedimentosController.setProfissionalResponsavel}" process="@this"> 
          <pe:assignableParam name="var1" assignTo="#{agendaProcedimentosController.profissionalResponsavelPrincipalId}"/> 
        </pe:remoteCommand> 
      </h:form>  
      <p:outputPanel id="panelTodo" layout="inline"> 
        <h:form prependId="false" id="formPrincipal"> 
          <p:accordionPanel id="togglePanelCirurgia"  prependId="false"> 
            <p:tab title="#{messages.LABEL_CIRURGIA}"> 
              <p:outputPanel id="panelCirurgia"> 
                <aghu:linha> 
                  	
                  	<mec:suggestionBox id="unidadeCirurgica" label="#{messages.LABEL_UNIDADE_CIRURGICA_AGENDAMENTO}" title="#{messages.TITLE_INFORME_UNIDADE_FUNCIONAL}" 
                  		descricaoInput="seq" descricaoLabel="descricao" suggestionAction="pesquisarUnidadesCirurgicas" posDeleteAction="posRemoverUnidadeCirurgica" 
                  		width="500" required="true" maxlength="20" readonly="#{agendaProcedimentosController.emEdicao}" controller="#{agendaProcedimentosController}" 
                  		value="#{agendaProcedimentosController.vo.cirurgia.unidadeFuncional}" render="especialidade, dataAgendamento, horaControle, tempoPrevisto, salaCirurgica, projeto, modalConvenioPanel,            
                  		origemPaciente, naturezaFichaAnesiaItens, numeroAgenda, leitoPac, pesqPaciente, prontuario, pacCodigo, pacNome, salaCirurgicaPanel,            
                  		projetoPesquisaPanel,panelProcedimentos,tabelaProcedimentosCirurgia,panelProfissionais,tabelaProfissionaisCirurgia,panelAnestesias,            
                  		tabelaAnestesiaCirurgia,botaoAdicionarProfissionalPanel"
                  		var="_unidCir" itemValue="#{_unidCir}">
                  	<p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CODIGO}" style="font-weight: bold;"/> 
                      </f:facet>
                      <h:outputText value="#{_unidCir.seq}" /> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_DESCRICAO}" style="font-weight: bold;"/> 
                      </f:facet> 
                      <h:outputText value="#{_unidCir.descricao}" /> 
                    </p:column> 
                  </mec:suggestionBox>  
                  
                  <mec:suggestionBox id="especialidade" label="#{messages.LABEL_ESPECIALIDADE}" title="#{messages.TITLE_INFORME_ESPECIALIDADE_CIRURGIA}" descricaoInput="sigla" 
                  	  descricaoLabel="nomeEspecialidade" suggestionAction="pesquisarEspecialidadesProcedimentos" posSelectionAction="posSelecionarEspecialidadeCirurgia" 
                  	  required="true" maxlength="20" width="300" controller="#{agendaProcedimentosController}" value="#{agendaProcedimentosController.vo.cirurgia.especialidade}" 
                  	  render="panelProcedimentos" var="_especialidade" itemValue="#{_especialidade}"> 
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_SIGLA}" style="font-weight: bold;"/> 
                      </f:facet>
                      <h:outputText value="#{_especialidade.sigla}" /> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ESPECIALIDADE}" style="font-weight: bold;"/> 
                      </f:facet> 
                      <h:outputText value="#{_especialidade.nomeEspecialidade}" /> 
                    </p:column> 
                  </mec:suggestionBox> 
                  
                </aghu:linha>  
                <aghu:linha> 
                
                  <mec:inputTextData id="dataAgendamento" label="#{messages.LABEL_DATA_AGENDAMENTO}" title="#{messages.TITLE_DATA_AGENDAMENTO}" 
                 		 value="#{agendaProcedimentosController.vo.cirurgia.data}" required="true" readonly="#{agendaProcedimentosController.emEdicao}" tipo="data"> 
                  		 <p:ajax event="dateSelect" bypassUpdates="false" process="@this"/>
                  		 <p:ajax event="blur" action="#{agendaProcedimentosController.vo.cirurgia.data}" />
                  </mec:inputTextData>  
                  
                   <mec:inputTextData label="#{messages.LABEL_HORA_INICIO_CIRURGIA}" title="#{messages.TITLE_HORA_INICIO_CIRURGIA}" required="true" 
                   		value="#{agendaProcedimentosController.vo.cirurgia.dataPrevisaoInicio}" id="horaControle" tipo="hora">
	                   	<p:ajax event="dateSelect" bypassUpdates="false" process="@this" ajax="true"/>
	                   	<p:ajax event="blur" action="#{agendaProcedimentosController.vo.cirurgia.dataPrevisaoInicio}" />
                   </mec:inputTextData>
                   
                   <mec:inputTextData id="tempoPrevisto" label="#{messages.LABEL_TEMPO_PREVISTO_AGENDAMENTO}" title="#{messages.TITLE_TEMPO_PREVISTO_AGENDAMENTO}" 
                   required="true" value="#{agendaProcedimentosController.tempoPrevisto}" tipo="hora">
                   		<p:ajax event="dateSelect" bypassUpdates="false" process="@this" ajax="true"/>
                   		<p:ajax event="blur" action="#{agendaProcedimentosController.tempoPrevisto}" />
                   </mec:inputTextData>
                   
                  <p:outputPanel id="salaCirurgicaPanel" layout="inline"> 
                    <mec:suggestionBox id="salaCirurgica" label="#{messages.LABEL_SALA_CIRURGICA}" 
	                    title="#{messages.TITLE_INFORME_NUMERO_SALA_CIRURGICA_UNIDADE}" descricaoInput="id.seqp" descricaoLabel="nome" 
	                    suggestionAction="pesquisarSalasCirurgicas" width="250" size="4" maxlength="3" required="true" 
	                    readonly="#{agendaProcedimentosController.emEdicao or agendaProcedimentosController.vo.cirurgia.unidadeFuncional == null}" 
	                    numeric="true" controller="#{agendaProcedimentosController}" 
	                    value="#{agendaProcedimentosController.vo.cirurgia.salaCirurgica}"
	                    var="_salaCir" itemValue="#{_salaCir}"> 
                      <p:column> 
                        <f:facet name="header"> 
                          <h:outputText value="#{messages.LABEL_SALA_CIRURGIA}" style="font-weight: bold;"/> 
                        </f:facet> #{_salaCir.id.seqp}
                      </p:column>  
                      <p:column> 
                        <f:facet name="header"> 
                          <h:outputText value="#{messages.LABEL_SITUACAO}" style="font-weight: bold;"/> 
                        </f:facet> #{_salaCir.situacao.descricao}
                      </p:column> 
                    </mec:suggestionBox> 
                  </p:outputPanel> 
                </aghu:linha>  
                
                <aghu:linha> 
                  <p:outputPanel id="projetoPesquisaPanel" layout="inline"> 
                    <mec:suggestionBox id="projeto" label="#{messages.LABEL_PROJETO_PESQUISA}" 
                    	title="#{messages.TITLE_PROJETO_GRUPO_PESQUISA}" descricaoInput="numero" descricaoLabel="nome" maxlength="20" 
                    	width="600" suggestionAction="pesquisarProjetosPesquisa" 
                    	readonly="#{agendaProcedimentosController.vo.cirurgia.unidadeFuncional == null}" 
                    	controller="#{agendaProcedimentosController}" value="#{agendaProcedimentosController.vo.cirurgia.projetoPesquisa}"
                    	var="_projPesq" itemValue="#{_projPesq}"> 
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_NUMERO}</b> 
                        </f:facet> #{_projPesq.numero}
                      </p:column>  
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_NOME}</b> 
                        </f:facet> #{_projPesq.nome}
                      </p:column> 
                    </mec:suggestionBox> 
                  </p:outputPanel> 
                </aghu:linha>  
                
                <aghu:linha> 
                  <p:outputPanel id="modalConvenioPanel" layout="inline"> 
                    <mec:inputNumero label="#{messages.CODIGO_CONVENIO}" title="#{messages.TITLE_CODIGO_CONVENIO_PACIENTE}" size="3" maxlength="3" 
                    value="#{agendaProcedimentosController.convenioId}" readonly="#{not empty agendaProcedimentosController.plano}" id="codigoConvenio"> 
                      <p:ajax event="blur" bypassUpdates="false" process="@this"/> 
                    </mec:inputNumero>  
                      <mec:inputNumero name="inputCodigoPlano" id="inputCodigoPlano" size="2" converter="#{javax.faces.Byte}" styleClass="numerico" 
                      	readonly="#{not empty agendaProcedimentosController.plano}" disabled="#{not empty agendaProcedimentosController.plano}" maxlength="2" 
                      	value="#{agendaProcedimentosController.planoId}" label="#{messages.CODIGO_PLANO}" title="#{messages.TITLE_INFORME_CONVENIO_PLANO}"> 
                        <p:ajax event="change" bypassUpdates="false" update="@(#modalConvenioPanel)" process="@this" listener="#{agendaProcedimentosController.selecionarPlanoConvenio()}"/> 
                      </mec:inputNumero> 
                    <p:outputPanel id="panelPlanoConvenio" layout="inline"> 
                      <mec:suggestionBox label="#{messages.LABEL_CONVENIO_PLANO}" title="#{messages.TITLE_CONVENIO_PLANO_SAUDE_PACIENTE}" 
	                      width="600" maxlength="20" descricaoInput="descricao" descricaoLabel="descricaoPlanoConvenio" 
	                      suggestionAction="pesquisarConvenioSaudePlanos" posSelectionAction="atribuirPlano" posDeleteAction="atribuirPlano" 
	                      required="true" id="planoConvenio" controller="#{agendaProcedimentosController}" value="#{agendaProcedimentosController.plano}" 
	                      render="modalConvenioPanel" var="_convenio" itemValue="#{_convenio}"> 
                        <p:column> 
                          <f:facet name="header"> 
                            <b>#{messages.LABEL_CONVENIO}</b> 
                          </f:facet> #{_convenio.id.cnvCodigo}
                        </p:column>  
                        <p:column> 
                          <f:facet name="header"> 
                            <b>#{messages.LABEL_PLANO}</b> 
                          </f:facet> #{_convenio.id.seq}
                        </p:column>  
                        <p:column> 
                          <f:facet name="header"> 
                            <b>#{messages.LABEL_DESCRICAO}</b> 
                          </f:facet> #{_convenio.convenioSaude.descricao} - #{_convenio.descricao}
                        </p:column> 
                      </mec:suggestionBox> 
                    </p:outputPanel> 
                  </p:outputPanel> 
                </aghu:linha>  
                <aghu:linha> 
                  <mec:selectOneMenu id="origemPaciente" enum="DominioOrigemPacienteCirurgia" label="#{messages.LABEL_ORIGEM_PACIENTE_CIRURGIA_AGENDAMENTO}" 
                  	title="#{messages.TITLE_ORIGEM_PACIENTE_POSSUI_CIRURGIA}" required="true" value="#{agendaProcedimentosController.vo.cirurgia.origemPacienteCirurgia}"> 
                    <p:ajax event="change" process="@this" listener="#{agendaProcedimentosController.validaOrigemComPlano()}"/> 
                  </mec:selectOneMenu>  
                    <mec:selectOneMenu id="naturezaFichaAnesiaItens" required="true" label="#{messages.LABEL_NATUREZA_AGENDAMENTO}" title="#{messages.TITLE_NATUREZA_AGENDAMENTO}" value="#{agendaProcedimentosController.vo.cirurgia.naturezaAgenda}"> 
			              <f:converter converterId="dominioConverter" for="naturezaFichaAnesiaItens"/>  
			              <f:selectItems var="item" itemLabel="#{item.descricao}" value="#{agendaProcedimentosController.itensOrigemAtendimento}"/>  
                      	  <p:ajax event="change" bypassUpdates="false" process="@this"/> 
			          </mec:selectOneMenu>   
                  <mec:inputNumero id="numeroAgenda" label="#{messages.LABEL_AGENDA_AGENDAMENTO}" title="#{messages.TITLE_NUMERO_IDENTIFICA_AGENDA_CIRURGIA}" size="5" maxlength="3" readonly="true" value="#{agendaProcedimentosController.vo.cirurgia.numeroAgenda}"/> 
                </aghu:linha>  
                
                <aghu:linha> 
                  <mec:suggestionBox id="leitoPac" label="#{messages.LABEL_LEITO}" title="#{messages.TITLE_INFORME_CODIGO_LEITO}" 
                  	descricaoInput="leitoID" descricaoLabel="leitoID" suggestionAction="pesquisarLeitos" posSelectionAction="posSelecionarLeito" 
                  	width="200" size="6" maxlength="14" onkeypress="return TeclaEnter(event);" controller="#{agendaProcedimentosController}" 
                  	value="#{agendaProcedimentosController.leito}" render="pacienteDecorate" var="_leito" itemValue="#{_leito}"> 
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_LEITO}</b> 
                      </f:facet> #{_leito.leitoID}
                    </p:column> 
                  </mec:suggestionBox>   
                  <p:outputPanel id="pacienteDecorate" layout="inline"> 
              		<mec:pesquisaPaciente id="pesqPaciente" 
              			valueChangeListener="#{agendaProcedimentosController.pesquisaPaciente}" 
              			value="#{agendaProcedimentosController.paciente}" 
              			render="leitoPac" required="true" 
              			readonly="false"/>  
              		<br clear="none"/>  
              		<mec:commandButton id="pesqPacienteBt" value="#{messages.LABEL_PESQUISA_FONETICA}" immediate="true" 
              			readonly="false" action="#{agendaProcedimentosController.redirecionarPesquisaFonetica()}" 
              			styleClass="bt_cinza icon-pesquisa-fonetica" profile="search">
        	              <f:setPropertyActionListener target="#{pesquisaPacienteController.cameFrom}" value="blococirurgico-agendaProcedimentos" for="command"/>
        	           	  <f:setPropertyActionListener target="#{pesquisaPacienteController.exibeBotaoEditar}" value="true" for="command" />
						  <f:setPropertyActionListener target="#{pesquisaPacienteController.paramExibeBotaoIncluir}" value="true" for="command" />
						  <f:setPropertyActionListener target="#{pesquisaPacienteController.exibirBotaoIncluirPacienteCirurgico}" value="true" for="command" />
		                  <f:param name="cid" value="#{javax.enterprise.context.conversation.id}"/> 
              		</mec:commandButton> 
            	  </p:outputPanel> 
               </aghu:linha> 
              </p:outputPanel> 
            </p:tab> 
          </p:accordionPanel>  
          
          
          <!--  PAINEL PROCEDIMENTOS -->
          <p:accordionPanel id="togglePanelProcedimentos"  prependId="false"> 
            <p:tab title="#{messages.LABEL_PROC_CIRURGICOS}"> 
              <aghu:linha> 
                <p:outputPanel id="panelProcedimentos" layout="inline"> 
                  <mec:suggestionBox id="sbEspecialidadeProcedimento" label="#{messages.LABEL_ESPECIALIDADE}" 
                  title="#{messages.TITLE_INFORME_ESPECIALIDADE_PROCEDIMENTO_CIRURGICO}" descricaoInput="sigla" descricaoLabel="nomeEspecialidade" 
                  suggestionAction="pesquisarEspecialidadesProcedimentos" posDeleteAction="posRemoverEspecialidadesProcedimento" 
                  width="300" controller="#{agendaProcedimentosController}" value="#{agendaProcedimentosController.especialidadeProcedimentoAdd}" 
                  render="panelProcedimentos" var="_esp" itemValue="#{_esp}"> 
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_SIGLA}" style="font-weight: bold;"/> 
                      </f:facet> #{_esp.sigla}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ESPECIALIDADE}" style="font-weight: bold;"/> 
                      </f:facet> #{_esp.nomeEspecialidade}
                    </p:column> 
                  </mec:suggestionBox>  
                  <mec:suggestionBox id="sbProcedimento" label="#{messages.TITLE_PROCEDIMENTO_CIRURGICO_TITULO_TELA}" 
	                  title="#{messages.TITLE_INFORME_PROCEDIMENTO_CIRURGICO_ADICIONADO}" suggestionAction="pesquisarProcedimentoCirurgicos" 
	                  descricaoInput="id.pciSeq" maxResults="1000" descricaoLabel="descricao" width="500" maxlength="60" posSelectionAction="isLateralidade" 
	                  posDeleteAction="limparLateralidade" readonly="#{empty agendaProcedimentosController.especialidadeProcedimentoAdd}" 
	                  controller="#{agendaProcedimentosController}" value="#{agendaProcedimentosController.procedimentoAdd}" 
	                  render="panelProcedimentos" var="_procedimentoCirg" itemValue="#{_procedimentoCirg}"> 
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_CODIGO}</b> 
                      </f:facet>
                      <h:outputText value="#{_procedimentoCirg.id.pciSeq}" />
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_DESCRICAO}</b> 
                      </f:facet>
                      <h:outputText value="#{_procedimentoCirg.descricao}" />
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_PROCEDIMENTO_CIRURGICO_TEMPO_MINIMO}</b> 
                      </f:facet>
                      <h:outputText value="#{_procedimentoCirg.tempoMinimo}" />
                    </p:column> 
                  </mec:suggestionBox>  
                  <mec:selectBooleanCheckbox id="indPrincipal" label="#{messages.LABEL_PRINCIPAL}" value="#{agendaProcedimentosController.indPrincipal}" rendered="#{not agendaProcedimentosController.existePrincipal}"> 
                    <p:ajax event="change" bypassUpdates="false" process="@this"/> 
                  </mec:selectBooleanCheckbox> 
                   
                  <mec:selectOneMenu id="inputIdLateralidade" value="#{agendaProcedimentosController.lateralidade}" required="false" rendered="#{not agendaProcedimentosController.existePrincipal}" title="#{messages.TITLE_PROCEDIMENTO_CIRURGICO_LADO}" label="#{messages.LABEL_PROCEDIMENTO_CIRURGICO_LADO}" disabled="#{agendaProcedimentosController.readOnlyLado}" onkeydown="enterInSelectField(event, '#{stopEnter}');">
                      <f:selectItems var="item" itemLabel="#{item.descricao}" value="#{agendaProcedimentosController.itensLateralidade}"/>
                      <p:ajax event="change" bypassUpdates="false" process="@this"/>
                  </mec:selectOneMenu>

                  
                </p:outputPanel>  
                <aghu:acao newLine="false"> 
                  <mec:commandButton id="bt_adicionar_proc" value="#{messages.LABEL_ADICIONAR}" action="#{agendaProcedimentosController.adicionarProcedimento}" process="@this" profile="add" ajax="true" render="panelProcedimentos,tabelaProcedimentosCirurgia"/> 
                </aghu:acao> 
              </aghu:linha>  
              <aghu:linha> 
                <div style="width: 100%; margin-top: 10px; max-height:150px; overflow-y: auto;"> 
                  <mec:serverDataTable id="tabelaProcedimentosCirurgia" list="#{agendaProcedimentosController.listaProcedimentos}" scrollable="false"> 
                    <c:set var="_procedimentoVO" value="#{item}"/>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ACAO}"/> 
                      </f:facet>  
                      <mec:commandLink id="removerProcedimento"  action="#{agendaProcedimentosController.removerProcedimento(_procedimentoVO)}" 
                       	title="#{messages.LABEL_EXCLUIR}" profile="delete" ajax="true" process="@this" render="tabelaProcedimentosCirurgia, panelProcedimentos"/>  
                      
                      <mec:commandLink id="quantidade" rendered="#{agendaProcedimentosController.isPermitirAlterarQuantidadeProcedimento(_procedimentoVO)}" 
                      action="#{agendaProcedimentosController.setProcedimentoQuantidadeAlterada(_procedimentoVO)}" oncomplete="PF('modalAlteracaoQuantidadeWG').show();;" 
                      title="#{messages.TITLE_QUANTIDADE_OCORRENCIAS_PROCEDIMENTO}" styleClass=" silk-flag-red silk-icon" ajax="true" 
                      render="tabelaProcedimentosCirurgia,fieldAtualizarPanel" process="@this"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_PRINCIPAL}"/> 
                      </f:facet>  
                      <h:graphicImage value="/resources/img/accept.png" rendered="#{_procedimentoVO.indPrincipal}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CODIGO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_procedimentoVO.seqPhi}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ESP_AGENDAMENTO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_procedimentoVO.sigla}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_DESCRICAO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_procedimentoVO.descricaoPhi}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_PROCEDIMENTO_CIRURGICO_LADO}"/> 
                      </f:facet>  
                      <h:outputText rendered="#{_procedimentoVO.indPrincipal}" value="#{_procedimentoVO.lado.descricao}"/>  
                      <mec:commandLink id="linkLado" immediate="true" rendered="#{agendaProcedimentosController.editaLado(_procedimentoVO)}" 
                      	title="#{messages.TITLE_PROCEDIMENTO_CIRURGICO_LADO}" action="#{agendaProcedimentosController.verificaLateralidade(_procedimentoVO)}" 
                      	oncomplete="PF('modalAlteracaoLadoWG').show();;" styleClass=" silk-flag-blue silk-icon" ajax="true" 
                      	render="tabelaProcedimentosCirurgia,fieldAtualizarPanelLado" process="@this"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_PROCEDIMENTO_CIRURGICO_CONTAMINACAO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_procedimentoVO.indContaminacao.descricao}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_PROCEDIMENTO_CIRURGICO_REGIME_SUS}"/> 
                      </f:facet>  
                      <h:outputText value="#{_procedimentoVO.regimeProcedSus.descricao}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_PROCEDIMENTO_CIRURGICO_TEMPO_MINIMO}"/> 
                      </f:facet>  
                      <h:outputText value="#{agendaProcedimentosController.obterTempoMinimoFormatado(_procedimentoVO.tempoMinimo)}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_QTDE_AGENDAMENTO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_procedimentoVO.qtd}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_SITUACAO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_procedimentoVO.situacao.descricao}"/> 
                    </p:column> 
                  </mec:serverDataTable> 
                </div> 
              </aghu:linha> 
            </p:tab> 
          </p:accordionPanel>  


		  <!-- PAINEL PROFISSIONAIS -->
          <p:accordionPanel id="togglePanelProfissionais"  prependId="false"> 
            <p:tab title="#{messages.LABEL_PROFISSIONAIS_CIRURGIA_AGENDAMENTO}"> 
              <aghu:linha> 
                <p:outputPanel id="panelProfissionais" layout="inline"> 
                  <mec:suggestionBox id="sbProfissional" label="#{messages.LABEL_PROFISSIONAL}" title="#{messages.TITLE_INFORME_PROFISSIONAL_ADICIONADO_CIRURGIA}" 
                 		suggestionAction="pesquisarProfissionais" descricaoInput="matricula" descricaoLabel="nome" width="900" maxlength="60" 
                  		readonly="#{agendaProcedimentosController.vo.cirurgia.unidadeFuncional == null}" controller="#{agendaProcedimentosController}" 
                  		value="#{agendaProcedimentosController.profissionalAdd}"
                  		maxResults="1000"
                  		posSelectionAction="adicionarProfissional"
                  		render="panelProfissionais, tabelaProfissionaisCirurgia, sbProfissional"
                  		var="_profiss" itemValue="#{_profiss}"> 
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_VINCULO}" style="font-weight: bold;"/> 
                      </f:facet> #{_profiss.vinCodigo}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_MATRICULA}" style="font-weight: bold;"/> 
                      </f:facet> #{_profiss.matricula}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CONSELHO_AGENDAMENTO}" style="font-weight: bold;"/> 
                      </f:facet> #{_profiss.cprSigla}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_NRO_REG_CONSELHO_AGENDAMENTO}" style="font-weight: bold;"/> 
                      </f:facet> #{_profiss.nroRegConselho}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_NOME}" style="font-weight: bold;"/> 
                      </f:facet> #{_profiss.nome}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_FUNCAO}" style="font-weight: bold;"/> 
                      </f:facet> #{_profiss.funcao.getDescricao()}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ESPECIALIDADE_AGENDAMENTO}" style="font-weight: bold;"/> 
                      </f:facet> #{_profiss.especialidade}
                    </p:column> 
                  </mec:suggestionBox> 
                </p:outputPanel>  
              </aghu:linha>  
              <aghu:linha> 
                <div style="width: 100%; margin-top: 10px; max-height:150px; overflow-y: auto;"> 
                  <mec:serverDataTable id="tabelaProfissionaisCirurgia" rowKeyVar="_indice" list="#{agendaProcedimentosController.listaProfissionais}" scrollable="false"> 
                    <c:set var="_profissionalVO" value="#{item}"/>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ACAO}"/> 
                      </f:facet>  
                      <mec:commandLink id="link_remover_prof" 
                      	action="#{agendaProcedimentosController.removerProfissionais(_profissionalVO)}" 
                      	title="#{messages.LABEL_EXCLUIR}" render="tabelaProfissionaisCirurgia"
                      	profile="delete" ajax="true" process="@this"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_RESPONSAVEL}"/> 
                      </f:facet>  
                      <input type="radio" name="profRespons" onchange="atualizarProfissionalPrincipal('#{_profissionalVO.hashCode}')"/>  
                      <p:outputPanel rendered="#{_profissionalVO.indResponsavel}" layout="inline"> 
                        <script xml:space="preserve">
												jQuery(
														'input:radio[name=profRespons]:nth(#{_indice})')
														.attr('checked', true);
											</script> 
                      </p:outputPanel> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_SIGLA}"/> 
                      </f:facet>  
                      <h:outputText value="#{_profissionalVO.funcaoProfissional}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_FUNCAO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_profissionalVO.funcaoProfissional.descricao}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_PROFISSIONAL}"/> 
                      </f:facet>  
                      <h:outputText value="#{_profissionalVO.servidorConselho.nome}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ESPECIALIDADE_AGENDAMENTO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_profissionalVO.especialidade}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CONSELHO_AGENDAMENTO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_profissionalVO.servidorConselho.sigla}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_NRO_REG_CONSELHO_AGENDAMENTO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_profissionalVO.servidorConselho.nroRegConselho}"/> 
                    </p:column> 
                  </mec:serverDataTable> 
                </div> 
              </aghu:linha> 
            </p:tab> 
          </p:accordionPanel>  
          
          <!-- PAINEL ANESTESISTAS -->
          <p:accordionPanel id="togglePanelAnestesias"  prependId="false"> 
            <p:tab title="#{messages.LABEL_ANESTESIAS}"> 
              <aghu:linha> 
                <p:outputPanel id="panelAnestesias" layout="inline"> 
                  <mec:suggestionBox id="sbAnestesia" label="#{messages.LABEL_ANESTESIA}" title="#{messages.TITLE_INFORME_ANESTESIA_AGENDAMENTO}" 
                  suggestionAction="pesquisarAnestesias" descricaoInput="seq" descricaoLabel="descricao" width="400" maxlength="60" 
                  controller="#{agendaProcedimentosController}" value="#{agendaProcedimentosController.tipoAnestesiaAdd}"
                  posSelectionAction="adicionarAnestesia"
                  render="panelAnestesias,tabelaAnestesiaCirurgia"
                  var="_anestes" itemValue="#{_anestes}"> 
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CODIGO}" style="font-weight: bold;"/> 
                      </f:facet> #{_anestes.seq}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_DESCRICAO}" style="font-weight: bold;"/> 
                      </f:facet> #{_anestes.descricao}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_NECESSITA_ANESTESIA}" style="font-weight: bold;"/> 
                      </f:facet> #{_anestes.indNessAnest ? 'Sim':'NÃ£o'}
                    </p:column> 
                  </mec:suggestionBox> 
                </p:outputPanel>  
              </aghu:linha>  
              <aghu:linha> 
                <div style="width: 100%;  margin-top: 10px; max-height:150px; overflow-y: auto;"> 
                  <mec:serverDataTable id="tabelaAnestesiaCirurgia" list="#{agendaProcedimentosController.listaAnestesias}" scrollable="false"> 
                    <c:set var="_anestesiaVO" value="#{item}"/>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ACAO}"/> 
                      </f:facet> 
                      <mec:commandLink id="link_remover_anes" action="#{agendaProcedimentosController.removerAnestesia(_anestesiaVO)}" 
                      title="#{messages.LABEL_EXCLUIR}" profile="delete" ajax="true" process="@this" render="tabelaAnestesiaCirurgia"/> 
                      
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CODIGO}"/> 
                      </f:facet>  
                      <h:outputText value="#{_anestesiaVO.mbcTipoAnestesias.seq}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ANESTESIA}"/> 
                      </f:facet>  
                      <h:outputText value="#{_anestesiaVO.mbcTipoAnestesias.descricao}"/> 
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_NECESSITA_ANESTESISTA}"/> 
                      </f:facet>  
                      <h:outputText value="#{_anestesiaVO.mbcTipoAnestesias.indNessAnest ? messages.LABEL_SIM : messages.LABEL_NAO }"/> 
                    </p:column> 
                  </mec:serverDataTable> 
                </div> 
              </aghu:linha> 
            </p:tab> 
          </p:accordionPanel>  
        
        
          <p:outputPanel id="panelIntegracoes" layout="inline"> 
            <aghu:acao> 
              <mec:commandButton id="bt_dispHorario" value="#{messages.LABEL_BT_DISP_HORARIO}" immediate="true" rendered="#{not agendaProcedimentosController.emEdicao}" 
              	block="true" disabled="#{not mf:hasPermission(securityController,'/blococirurgico/cadastroapoio/agendarProcedimentosEletUrgOuEmerg.xhtml,render')}" 
              	action="#{agendaProcedimentosController.getDisponibilidadeHorario}" styleClass="bt_cinza"/>  
              
              <mec:commandButton id="bt_solicHemo" value="#{messages.LABEL_BT_SOLIC_HEMOTERAPICA}" immediate="true" 
              	disabled="#{not mf:hasPermission(securityController,'visualizarSolicitacaoHemoterapica,visualizar')}" rendered="#{agendaProcedimentosController.emEdicao}"
                block="true" action="#{agendaProcedimentosController.getSolicitacaoHemoterapica}" styleClass="bt_cinza"/>  
               
              <mec:commandButton id="bt_solicEsp" value="#{messages.LABEL_BT_SOLIC_ESPECIAIS}" immediate="true" 
              	disabled="#{not mf:hasPermission(securityController,'manterSolicitaoEspecial,executar') and not mf:hasPermission(securityController,'manterSolicitaoEspecial,consultar')}" 
              	rendered="#{agendaProcedimentosController.emEdicao}" block="true" action="#{agendaProcedimentosController.getCadastroSolicitacoesEspeciais}" styleClass="bt_cinza"/>  
              
              <mec:commandButton id="bt_ortPro" value="#{messages.LABEL_BT_ORT_PROT}" immediate="true" 
              	disabled="#{not mf:hasPermission(securityController,'manterOrteseProtese,executar') and not mf:hasPermission(securityController,'manterOrteseProtese,consultar')}" 
              	rendered="#{agendaProcedimentosController.emEdicao}" block="true" action="#{agendaProcedimentosController.getCadastroOrteseProtese}" styleClass="bt_cinza"/>  
              
              <mec:commandButton id="bt_impNotaSala" value="#{messages.LABEL_BT_IMP_NOTA_SALA}" immediate="true" 
              	disabled="#{not mf:hasPermission(securityController,'visualizarNotaConsumoSala,visualizar')}" rendered="#{agendaProcedimentosController.emEdicao}" block="true" 
              	action="#{agendaProcedimentosController.getRelatorioImpNotaSala}" styleClass="bt_cinza"/>  
           
              <mec:commandButton id="bt_anotacoes" value="#{messages.LABEL_BT_ANOTACOES}" immediate="true" 
           	   	disabled="#{not mf:hasPermission(securityController,'manterAnotacoesAgendamentoEletivo,executar') and not mf:hasPermission(securityController,'manterAnotacoesAgendamentoEletivo,consultar')}" 
            	rendered="#{agendaProcedimentosController.emEdicao}" block="true" action="#{agendaProcedimentosController.getCadastroAnotacoes}" styleClass="bt_cinza"/> 
            </aghu:acao> 
          </p:outputPanel>  

          <aghu:acao> 

            <mec:commandButton id="bt_salvar" value="#{messages.LABEL_GRAVAR}" block="true" requestDelay="2000" 
            	action="#{agendaProcedimentosController.agendarProcedimentosParte1}" profile="ok"
            	render="panelCirurgia,panelIntegracoes, painel_acoes, panelModalAlertaBotaoGravar, panelModalValidacaoTempoMinimo" />  
            
            <mec:backButton id="bt_cancelar" value="#{messages.LABEL_CANCELAR}" immediate="true" 
            	rendered="#{not empty agendaProcedimentosController.voltarPara}" action="#{agendaProcedimentosController.cancelar}"/>  
            
            <mec:commandButton id="bt_novoAgendamento" value="#{messages.LABEL_NOVO_AGENDAMENTO}" 
            	action="#{agendaProcedimentosController.novoAgendamento}" rendered="#{agendaProcedimentosController.emEdicao}" 
            	profile="add"  render="formPrincipal" /> 
          </aghu:acao> 

        </h:form>  
        
        <p:dialog id="modalAlteracaoQuantidade" width="400" height="150" modal="true" resizable="false" widgetVar="modalAlteracaoQuantidadeWG"> 
          <f:facet name="header"> 
            <h:panelGroup> 
              <h:outputText value="#{messages.LABEL_ALTERAR_QTDE}"/> 
            </h:panelGroup> 
          </f:facet>  
          <h:form prependId="false" id="formQtde"> 
            <h:panelGroup> 
              <aghu:linha> 
                  <mec:inputNumero id="qtdeOcurrProc" value="#{agendaProcedimentosController.procedimentoQuantidadeAlterada.qtd}"
                   size="3" required="true" label="#{messages.LABEL_QTDE_OCORRENCIA_AGENDAMENTO}" title="#{messages.TITLE_QTDE_OCORRENCIA_AGENDAMENTO}" maxlength="2"/> 
              </aghu:linha> 
            </h:panelGroup>  
            <aghu:acao> 
              <aghu:linha> 
              <mec:commandButton value="#{messages.LABEL_ALTERAR}" block="true" id="atualizar" 
	             	oncomplete="if(#{facesContext.maximumSeverity==null}){PF('modalAlteracaoQuantidadeWG').hide();;}" 
    	          	profile="ok" ajax="true" render="Messages, tabelaProcedimentosCirurgia"/>  
              
              <mec:commandButton value="#{messages.LABEL_CANCELAR}" id="bt_fechar" 
              		oncomplete="PF('modalAlteracaoQuantidadeWG').hide();"  ajax="true" process="@this"
              		profile="cancel"
              		render="tabelaProcedimentosCirurgia" styleClass="bt_cinza"/> 
              </aghu:linha>
            </aghu:acao> 
          </h:form> 
        </p:dialog>  
        
        <p:outputPanel id="panelModalValidacaoTempoMinimo" layout="inline"> 
          <p:dialog id="modalValidacaoTempoMinimo" width="400" height="150" showWhenRendered="#{agendaProcedimentosController.exibirModalValidacaoTempoMinimoPrevisto}" 
          	visible="#{agendaProcedimentosController.exibirModalValidacaoTempoMinimoPrevisto}"		
          	modal="true" resizable="false" widgetVar="modalValidacaoTempoMinimoWG"> 
            <f:facet name="header"> 
              <h:panelGroup> 
                <h:outputText value="#{agendaProcedimentosController.alertaVO.titulo}"/> 
              </h:panelGroup> 
            </f:facet> #{agendaProcedimentosController.alertaVO.alerta} 
            <br clear="none"/>  
            <br clear="none"/>  
            <br clear="none"/>  
            <h:panelGroup> 
              <h:form prependId="false" id="formModalValidTempoMinBotaoGravar"> 
                <mec:commandButton value="#{messages.LABEL_SIM}" oncomplete="PF('modalValidacaoTempoMinimoWG').hide();" 
                		block="true" action="#{agendaProcedimentosController.popularInputTempoMinimo}" render="tempoPrevisto" profile="ok"/>  
                <mec:commandButton value="#{messages.LABEL_NAO}" onclick="PF('modalValidacaoTempoMinimoWG').hide();" profile="cancel" ajax="true"/> 
              </h:form> 
            </h:panelGroup> 
          </p:dialog> 
        </p:outputPanel>  
        
        <p:outputPanel id="panelModalAlertaBotaoGravar" layout="inline"> 
          <p:dialog id="modalAlertaBotaoGravar" width="400" height="150" showWhenRendered="#{agendaProcedimentosController.exibirModalAlertaGravar}" 
          	visible="#{agendaProcedimentosController.exibirModalAlertaGravar}" 
          	modal="true" resizable="false" widgetVar="modalAlertaBotaoGravarWG"> 
            <f:facet name="header"> 
              <h:panelGroup> 
                <h:outputText value="#{agendaProcedimentosController.alertaVO.titulo}"/> 
              </h:panelGroup> 
            </f:facet> #{agendaProcedimentosController.alertaVO.alerta} 
            <br clear="none"/>  
            <br clear="none"/>  
            <br clear="none"/>  
            <h:panelGroup> 
              <h:form prependId="false" id="formModalAlertaBotaoGravar"> 
                <mec:commandButton id="bt_sim" value="#{messages.LABEL_SIM}" oncomplete="PF('modalAlertaBotaoGravarWG').hide();" block="true" 
                requestDelay="2000" action="#{agendaProcedimentosController.pressionarBotaoSimModal}" render="panelCirurgia,panelIntegracoes" profile="ok"/>  
                <mec:commandButton id="bt_nao" value="#{messages.LABEL_NAO}" oncomplete="PF('modalAlertaBotaoGravarWG').hide();" block="true" requestDelay="2000" 
                action="#{agendaProcedimentosController.pressionarBotaoNaoModal}" render="panelCirurgia,panelIntegracoes" profile="cancel"/> 
              </h:form> 
            </h:panelGroup> 
          </p:dialog> 
        </p:outputPanel>  
        
        <p:dialog id="modalAlteracaoLado" style="text-align:center;" width="400" height="150" modal="true" resizable="false" widgetVar="modalAlteracaoLadoWG"> 
          <f:facet name="header"> 
            <h:outputText value="#{messages.LABEL_ALTERAR_LADO}"/> 
          </f:facet>  
          <aghu:linha> 
            <h:form prependId="false" id="formLado"> 
              <aghu:panelGeral> 
                <p:outputPanel id="fieldAtualizarPanelLado" layout="inline"> 
                  <aghu:linha>
	                  <mec:field name="idLateralidade2" id="idLateralidade2" required="false" 
	                  inputId="inputIdLateralidade" label="#{messages.LABEL_PROCEDIMENTO_CIRURGICO_LADO}" 
	                  title="#{messages.TITLE_PROCEDIMENTO_CIRURGICO_LADO}" rendered="#{not agendaProcedimentosController.existePrincipal}"
	                  readonly ="#{agendaProcedimentosController.readOnlyLado}" posicaoLabel="#{mf:getDefaultValue(posicaoLabel,'acima')}">
	                  
	                    <h:selectOneMenu id="inputIdLateralidade2" value="#{agendaProcedimentosController.procedimentoLadoAlterado.lado}" 
	                    	title="#{messages.TITLE_PROCEDIMENTO_CIRURGICO_LADO}" label="#{messages.LABEL_PROCEDIMENTO_CIRURGICO_LADO}" 
		                    readonly="#{agendaProcedimentosController.readOnlyLado}" onkeydown="enterInSelectField(event, '#{stopEnter}');"> 
	                      <f:selectItem itemValue="" itemLabel="#{mf:getDefaultValue(noSelectionLabel,'Selecione')}" noSelectionOption="true"/>  
	                      <f:converter converterId="dominioConverter" for="inputId"/>  
	                      <f:selectItems var="item" itemLabel="#{item.descricao}" value="#{agendaProcedimentosController.itensLateralidade}"/>  
	                      <p:ajax event="change" bypassUpdates="false" process="@this"/> 
	                    </h:selectOneMenu> 
	                  </mec:field>
                  </aghu:linha> 
                </p:outputPanel>  
                <br clear="none"/>  
                <aghu:linha>
                	<mec:commandButton value="#{messages.LABEL_ALTERAR}" id="atualizarLado" action="#{agendaProcedimentosController.setaLado}" 
	                	oncomplete="if(#{facesContext.maximumSeverity==null}){PF('modalAlteracaoLadoWG').hide();;}" profile="ok" ajax="true" 
	                	render="Messages, tabelaProcedimentosCirurgia, panelProcedimentos"/>  
                	<mec:commandButton id="bt_fecharLado" onclick="PF('modalAlteracaoLadoWG').hide();" value="#{messages.LABEL_CANCELAR}" profile="cancel"
                		 ajax="true" render="tabelaProcedimentosCirurgia"/>
                </aghu:linha> 
              </aghu:panelGeral> 
            </h:form> 
          </aghu:linha> 
        </p:dialog>
         
      </p:outputPanel> 
    </ui:define> 
  </ui:composition> 
</html>
